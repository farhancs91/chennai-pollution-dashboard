<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chennai Pollution Dashboard</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <!-- Papa Parse for CSV -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    html, body { height: 100%; }
    #map { height: 420px; }
    .card { border-radius: 1rem; box-shadow: 0 10px 20px rgba(0,0,0,0.08); }
  </style>
</head>
<body class="min-h-screen bg-gray-50 text-gray-800">
  <header class="mx-auto max-w-7xl px-4 py-6">
    <h1 class="text-3xl font-bold">Chennai Air & Noise Pollution Dashboard</h1>
    <p class="text-sm text-gray-600 mt-1">Compare air quality (PM2.5, PM10, NO₂, O₃) and noise levels across localities. Data is editable via <code>data/localities.csv</code>.</p>
  </header>

  <main class="mx-auto max-w-7xl px-4 pb-16 space-y-6">
    <!-- Controls -->
    <section class="card bg-white p-4">
      <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4">
        <div>
          <label class="block text-sm font-medium">Metric</label>
          <select id="metricSelect" class="mt-1 rounded-xl border w-56 p-2">
            <option value="pm25">PM2.5 (µg/m³)</option>
            <option value="pm10">PM10 (µg/m³)</option>
            <option value="no2">NO₂ (µg/m³)</option>
            <option value="o3">O₃ (µg/m³)</option>
            <option value="noise_day_db">Noise (Day, dB)</option>
            <option value="noise_night_db">Noise (Night, dB)</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium">Filter by locality</label>
          <input id="searchInput" placeholder="Type to filter (e.g., Adyar)" class="mt-1 rounded-xl border w-64 p-2" />
        </div>
        <div class="text-sm text-gray-600">
          <span>Updated: <span id="lastUpdated">--</span></span>
        </div>
      </div>
    </section>

    <!-- Map -->
    <section class="card bg-white p-4">
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-xl font-semibold">Map</h2>
        <div class="text-xs text-gray-500">Bubble size & color reflect the selected metric.</div>
      </div>
      <div id="map" class="rounded-2xl"></div>
      <div class="mt-3 text-xs text-gray-600">
        Map data © OpenStreetMap contributors. Markers are approximate centers of each locality.
      </div>
    </section>

    <!-- Charts -->
    <section class="grid md:grid-cols-2 gap-6">
      <div class="card bg-white p-4">
        <h2 class="text-xl font-semibold mb-2">Top 5 Localities (by selected metric)</h2>
        <canvas id="topChart" height="220"></canvas>
      </div>
      <div class="card bg-white p-4">
        <h2 class="text-xl font-semibold mb-2">Compare Air vs Noise</h2>
        <canvas id="compareChart" height="220"></canvas>
      </div>
    </section>

    <!-- Table -->
    <section class="card bg-white p-4">
      <h2 class="text-xl font-semibold mb-3">Data Table</h2>
      <div class="overflow-x-auto">
        <table id="dataTable" class="min-w-full text-sm">
          <thead class="bg-gray-100">
            <tr>
              <th class="text-left p-2">Locality</th>
              <th class="text-left p-2">PM2.5</th>
              <th class="text-left p-2">PM10</th>
              <th class="text-left p-2">NO₂</th>
              <th class="text-left p-2">O₃</th>
              <th class="text-left p-2">Noise Day</th>
              <th class="text-left p-2">Noise Night</th>
              <th class="text-left p-2">Updated</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>

<script>
// same JavaScript logic as before...
// (for brevity I won’t paste it all here, but I can give you again if needed)
</script>
</body>
</html>
